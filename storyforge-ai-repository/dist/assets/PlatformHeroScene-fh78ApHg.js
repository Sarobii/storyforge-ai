var f=Object.defineProperty;var g=(h,o,e)=>o in h?f(h,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[o]=e;var a=(h,o,e)=>g(h,typeof o!="symbol"?o+"":o,e);import{P as r}from"./index-x1V5TmgY.js";import{B as v}from"./BaseGameScene-DWO2C2i8.js";class S extends v{constructor(e){super("PlatformHeroScene");a(this,"player");a(this,"platforms");a(this,"movingPlatforms",[]);a(this,"enemies");a(this,"collectibles");a(this,"powerups",[]);a(this,"spikes");a(this,"checkpoint");a(this,"goalFlag");a(this,"isGrounded",!1);a(this,"canDoubleJump",!1);a(this,"hasDoubleJumped",!1);a(this,"jumpPower",400);a(this,"moveSpeed",160);a(this,"activePowerups",new Map);a(this,"currentLevel",1);a(this,"maxLevels",3);a(this,"particles");this.init(e)}preload(){console.log("PlatformHeroScene: Starting preload..."),this.load.image("platform","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==");const e=this.add.graphics();e.fillStyle(4286945),e.fillRect(0,0,32,32),e.generateTexture("hero",32,32),e.clear(),e.fillStyle(16729156),e.fillTriangle(12,0,0,24,24,24),e.generateTexture("enemy_sprites",24,24),e.clear(),e.fillStyle(9127187),e.fillRect(0,0,32,32),e.generateTexture("environment",32,32),e.clear(),e.fillStyle(16766720),e.fillCircle(8,8,6),e.generateTexture("items",16,16),e.destroy(),console.log("PlatformHeroScene: Preload complete!")}create(){super.create(),this.physics.world.setBounds(0,0,2400,600),this.createLevel(),this.createPlayer(),this.createEnemies(),this.createCollectibles(),this.createPowerups(),this.createParticleSystem(),this.setupCollisions(),this.setupCamera(),this.adjustDifficulty()}createLevel(){this.add.rectangle(1200,300,2400,600,8900331,.5),this.platforms=this.physics.add.staticGroup(),this.spikes=this.physics.add.staticGroup();for(let s=0;s<2400;s+=200)if(s<600||s>800){const i=this.add.rectangle(s,580,200,40,9127187);this.platforms.add(i)}[{x:300,y:450},{x:600,y:350},{x:900,y:400},{x:1200,y:300},{x:1500,y:250},{x:1800,y:200},{x:2100,y:350}].forEach(s=>{const i=this.add.rectangle(s.x,s.y,150,20,6636321);this.platforms.add(i)}),this.createMovingPlatforms(),[800,1e3,1400,1700].forEach(s=>{const i=this.add.triangle(s,560,0,20,10,0,20,20,16711680);i.setOrigin(.5,1),this.spikes.add(i)}),this.checkpoint=this.physics.add.sprite(1200,250,"items"),this.checkpoint.setTint(65280),this.checkpoint.setSize(32,64),this.checkpoint.body&&(this.checkpoint.body.immovable=!0),this.goalFlag=this.physics.add.sprite(2300,500,"items"),this.goalFlag.setTint(16766720),this.goalFlag.setSize(32,64),this.goalFlag.body&&(this.goalFlag.body.immovable=!0)}createMovingPlatforms(){const e=this.physics.add.sprite(700,400,"platform");e.setTint(10053324),e.setSize(120,20),e.body&&(e.body.immovable=!0);const t={sprite:e,isMoving:!0,startX:600,endX:800,speed:50};this.movingPlatforms.push(t);const s=this.physics.add.sprite(1600,300,"platform");s.setTint(10053324),s.setSize(120,20),s.body&&(s.body.immovable=!0);const i={sprite:s,isMoving:!0,startX:200,endX:400,speed:30};this.movingPlatforms.push(i)}createPlayer(){this.player=this.physics.add.sprite(100,450,"hero"),this.player.setSize(24,32),this.player.setBounce(.1),this.player.setCollideWorldBounds(!0),this.gameState.position&&this.player.setPosition(this.gameState.position.x,this.gameState.position.y),this.player.setTint(4286945)}createEnemies(){this.enemies=this.physics.add.group(),[{x:400,y:400},{x:1e3,y:350},{x:1400,y:200},{x:1900,y:150}].forEach(t=>{var i;const s=this.physics.add.sprite(t.x,t.y,"enemy_sprites");s.setTint(16729156),s.setSize(20,20),s.setBounce(1),s.setCollideWorldBounds(!0),(i=s.body)==null||i.setVelocity(r.Math.Between(-50,50),r.Math.Between(-100,-200)),this.enemies.add(s)})}createCollectibles(){this.collectibles=this.physics.add.group(),[{x:200,y:500},{x:450,y:400},{x:750,y:350},{x:1050,y:250},{x:1350,y:200},{x:1650,y:150},{x:1950,y:300},{x:2200,y:400}].forEach(t=>{const s=this.physics.add.sprite(t.x,t.y,"items");s.setTint(16766720),s.setSize(16,16),s.setBounce(.3),s.setCollideWorldBounds(!0),s.setData("type","coin"),s.setData("value",100),this.tweens.add({targets:s,y:t.y-10,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.collectibles.add(s)})}createPowerups(){[{x:500,y:300,type:"speed"},{x:1100,y:200,type:"jump"},{x:1700,y:100,type:"invincible"}].forEach(t=>{const s=this.physics.add.sprite(t.x,t.y,"items");switch(t.type){case"speed":s.setTint(65535);break;case"jump":s.setTint(16711935);break;case"invincible":s.setTint(16777215);break}s.setSize(20,20),s.setData("type",t.type),this.tweens.add({targets:s,scale:1.2,duration:500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const i={sprite:s,type:t.type,duration:t.type==="invincible"?5e3:1e4};this.powerups.push(i)})}createParticleSystem(){this.particles=this.add.particles(0,0,"items",{scale:{start:.1,end:0},speed:{min:50,max:100},lifespan:300,tint:16777215})}setupCollisions(){this.physics.add.collider(this.player,this.platforms,()=>{this.isGrounded=!0,this.hasDoubleJumped=!1}),this.movingPlatforms.forEach(e=>{this.physics.add.collider(this.player,e.sprite,()=>{var t;this.isGrounded=!0,this.hasDoubleJumped=!1,e.isMoving&&(this.player.x+=((t=e.sprite.body)==null?void 0:t.velocity.x)||0)})}),this.physics.add.collider(this.enemies,this.platforms),this.movingPlatforms.forEach(e=>{this.physics.add.collider(this.enemies,e.sprite)}),this.physics.add.overlap(this.player,this.enemies,(e,t)=>{this.handleEnemyCollision(t)}),this.physics.add.overlap(this.player,this.spikes,()=>{this.handleHazard()}),this.physics.add.overlap(this.player,this.collectibles,(e,t)=>{this.handleCollectible(t)}),this.powerups.forEach(e=>{this.physics.add.overlap(this.player,e.sprite,()=>{this.handlePowerup(e)})}),this.physics.add.overlap(this.player,this.checkpoint,()=>{this.handleCheckpoint()}),this.physics.add.overlap(this.player,this.goalFlag,()=>{this.handleGoal()})}setupCamera(){this.cameras.main.startFollow(this.player),this.cameras.main.setBounds(0,0,2400,600),this.cameras.main.setDeadzone(200,200)}adjustDifficulty(){switch(this.customization.difficulty){case"easy":this.jumpPower=450,this.moveSpeed=180,this.canDoubleJump=!0;break;case"medium":this.jumpPower=400,this.moveSpeed=160,this.canDoubleJump=!1;break;case"hard":this.jumpPower=350,this.moveSpeed=140,this.canDoubleJump=!1,this.createAdditionalEnemies();break}}createAdditionalEnemies(){[{x:600,y:300},{x:1300,y:150},{x:2e3,y:250}].forEach(t=>{var i;const s=this.physics.add.sprite(t.x,t.y,"enemy_sprites");s.setTint(16711680),s.setSize(20,20),s.setBounce(1),s.setCollideWorldBounds(!0),(i=s.body)==null||i.setVelocity(r.Math.Between(-70,70),-150),this.enemies.add(s)})}handleEnemyCollision(e){var t;if(this.activePowerups.has("invincible")){this.particles.emitParticleAt(e.x,e.y,10),e.destroy(),this.gameState.score+=200,this.updateUI();return}if(this.player.body&&e.body&&this.player.body.velocity.y>0&&this.player.y<e.y)this.particles.emitParticleAt(e.x,e.y,10),e.destroy(),this.player.body.setVelocityY(-200),this.gameState.score+=200,this.addToInventory({id:"enemy_defeat",name:"Enemy Defeated",type:"powerup",quantity:1});else{this.gameState.health-=20;const s=this.player.x<e.x?-200:200;(t=this.player.body)==null||t.setVelocity(s,-150),this.player.setTint(16711680),this.time.delayedCall(300,()=>{this.player.setTint(4286945)}),this.gameState.health<=0&&this.handleDeath()}this.updateUI()}handleHazard(){var e;this.activePowerups.has("invincible")||(this.gameState.health-=30,(e=this.player.body)==null||e.setVelocity(0,-300),this.particles.emitParticleAt(this.player.x,this.player.y,15),this.gameState.health<=0&&this.handleDeath(),this.updateUI())}handleCollectible(e){e.getData("type");const t=e.getData("value");this.gameState.score+=t,this.addToInventory({id:"coin",name:"Coin",type:"coin",quantity:1}),this.particles.emitParticleAt(e.x,e.y,5),e.destroy(),this.updateUI()}handlePowerup(e){switch(this.activePowerups.set(e.type,this.time.now+(e.duration||1e4)),e.type){case"speed":this.moveSpeed=240,this.addToInventory({id:"speed_boost",name:"Speed Boost",type:"powerup",quantity:1});break;case"jump":this.jumpPower=500,this.canDoubleJump=!0,this.addToInventory({id:"jump_boost",name:"Jump Boost",type:"powerup",quantity:1});break;case"invincible":this.player.setTint(16777215),this.addToInventory({id:"invincible",name:"Invincibility",type:"powerup",quantity:1});break}this.particles.emitParticleAt(e.sprite.x,e.sprite.y,20),e.sprite.destroy(),this.powerups=this.powerups.filter(t=>t!==e),this.gameState.score+=300,this.updateUI()}handleCheckpoint(){this.gameState.checkpoints=[{level:this.currentLevel,position:{x:this.player.x,y:this.player.y}}],this.checkpoint.setTint(65280),this.particles.emitParticleAt(this.checkpoint.x,this.checkpoint.y,10),this.addAchievement("checkpoint_reached"),this.saveGame()}handleGoal(){this.addAchievement("level_complete"),this.currentLevel<this.maxLevels?(this.currentLevel++,this.gameState.level=this.currentLevel,this.scene.restart()):(this.addAchievement("game_complete"),this.completeGame(this.gameState.score,this.gameState.achievements))}handleDeath(){var e;if(this.gameState.lives--,this.gameState.lives<=0)this.add.text(this.player.x,this.player.y-50,"GAME OVER",{fontSize:"24px",color:"#ff0000",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5),this.time.delayedCall(3e3,()=>{this.completeGame(this.gameState.score,this.gameState.achievements)});else{const t=this.gameState.checkpoints.length>0?this.gameState.checkpoints[this.gameState.checkpoints.length-1].position:{x:100,y:450};this.gameState.health=100,this.player.setPosition(t.x,t.y),(e=this.player.body)==null||e.setVelocity(0,0),this.updateUI()}}update(){var i,l,n,c,p,d,y,m,u;let e=0;const t=this.activePowerups.has("speed")?240:this.moveSpeed;(i=this.controls.keys)!=null&&i.left.isDown?e=-t:(l=this.controls.keys)!=null&&l.right.isDown&&(e=t),this.controls.mobile&&(this.controls.mobile.left&&(e=-t),this.controls.mobile.right&&(e=t)),(n=this.player.body)==null||n.setVelocityX(e),(((c=this.controls.keys)==null?void 0:c.up.isDown)||((p=this.controls.keys)==null?void 0:p.action.isDown)||((d=this.controls.mobile)==null?void 0:d.action))&&(this.isGrounded?((y=this.player.body)==null||y.setVelocityY(-this.jumpPower),this.isGrounded=!1):this.canDoubleJump&&!this.hasDoubleJumped&&((m=this.player.body)==null||m.setVelocityY(-this.jumpPower*.8),this.hasDoubleJumped=!0,this.particles.emitParticleAt(this.player.x,this.player.y+16,5))),((u=this.player.body)==null?void 0:u.velocity.y)!==0&&(this.isGrounded=!1),this.updateMovingPlatforms(),this.updatePowerups(),this.gameState.position={x:this.player.x,y:this.player.y},this.time.now%15e3<16&&this.saveGame()}updateMovingPlatforms(){this.movingPlatforms.forEach(e=>{if(!e.isMoving||!e.startX||!e.endX||!e.speed)return;const t=e.sprite;e===this.movingPlatforms[0]&&(t.x<=e.startX?t.body&&"setVelocity"in t.body&&t.body.setVelocity(e.speed,0):t.x>=e.endX&&t.body&&"setVelocity"in t.body&&t.body.setVelocity(-e.speed,0)),e===this.movingPlatforms[1]&&(t.y<=e.startX?t.body&&"setVelocity"in t.body&&t.body.setVelocity(0,e.speed):t.y>=e.endX&&t.body&&"setVelocity"in t.body&&t.body.setVelocity(0,-e.speed))})}updatePowerups(){const e=this.time.now;this.activePowerups.forEach((t,s)=>{if(e>t)switch(this.activePowerups.delete(s),s){case"speed":this.moveSpeed=160;break;case"jump":this.jumpPower=400,this.canDoubleJump=this.customization.difficulty==="easy";break;case"invincible":this.player.setTint(4286945);break}})}}export{S as PlatformHeroScene};

var f=Object.defineProperty;var w=(d,c,t)=>c in d?f(d,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[c]=t;var l=(d,c,t)=>w(d,typeof c!="symbol"?c+"":c,t);import{P as n}from"./index-x1V5TmgY.js";import{B as x}from"./BaseGameScene-DWO2C2i8.js";class C extends x{constructor(t){super("PixelQuestScene");l(this,"player");l(this,"enemies",[]);l(this,"npcs",[]);l(this,"collectibles");l(this,"doors");l(this,"walls");l(this,"lastAttack",0);l(this,"attackCooldown",500);l(this,"currentRoom",0);l(this,"totalRooms",3);l(this,"dialogueBox",null);l(this,"currentNPC",null);this.init(t)}preload(){console.log("PixelQuestScene: Starting preload..."),this.load.image("wall","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==");const t=this.add.graphics();t.fillStyle(4286945),t.fillRect(0,0,32,32),t.generateTexture("hero",32,32),t.clear(),t.fillStyle(16737894),t.fillRect(0,0,24,24),t.generateTexture("enemy_sprites",24,24),t.clear(),t.fillStyle(2263842),t.fillRect(0,0,32,32),t.generateTexture("environment",32,32),t.clear(),t.fillStyle(16766720),t.fillCircle(8,8,8),t.generateTexture("items",16,16),t.destroy(),console.log("PixelQuestScene: Preload complete!")}create(){super.create(),this.createRoom(),this.createPlayer(),this.createEnemies(),this.createNPCs(),this.createCollectibles(),this.setupCollisions(),this.setupCamera(),this.gameState.position={x:this.player.x,y:this.player.y}}createRoom(){this.walls=this.physics.add.staticGroup();const t=800,s=600,e=32,i=this.add.rectangle(t/2,e/2,t,e,9127187),h=this.add.rectangle(t/2,s-e/2,t,e,9127187),r=this.add.rectangle(e/2,s/2,e,s,9127187),o=this.add.rectangle(t-e/2,s/2,e,s,9127187);this.walls.addMultiple([i,h,r,o]);for(let a=0;a<3;a++){const p=150+a*200,y=200+a%2*200,g=this.add.rectangle(p,y,64,64,6636321);this.walls.add(g)}if(this.doors=this.physics.add.group(),this.currentRoom<this.totalRooms-1){const a=this.physics.add.sprite(t-50,s/2,"wall");a.setTint(9127187),a.setSize(32,64),a.body&&(a.body.immovable=!0),this.doors.add(a)}this.add.rectangle(t/2,s/2,t,s,2263842,.3)}createPlayer(){this.player=this.physics.add.sprite(100,300,"hero"),this.player.setTint(16777215),this.player.setSize(24,32),this.player.setCollideWorldBounds(!0),this.gameState.position&&this.player.setPosition(this.gameState.position.x,this.gameState.position.y)}createEnemies(){var t,s,e;this.enemies=[];for(let i=0;i<3;i++){const h=200+i*200,r=150+i%2*300,o=this.physics.add.sprite(h,r,"enemy_sprites");o.setTint(16737894),o.setSize(24,24),(t=o.body)==null||t.setCollideWorldBounds(!0),(s=o.body)==null||s.setVelocity(n.Math.Between(-50,50),n.Math.Between(-50,50));const a={sprite:o,health:30,type:"goblin",lastAttack:0};this.enemies.push(a),(e=o.body)==null||e.setBounce(1,1)}}createNPCs(){this.npcs=[];const t=this.physics.add.sprite(400,100,"hero");t.setTint(4286945),t.setSize(24,32),t.body&&(t.body.immovable=!0);const s={sprite:t,dialogue:[`Greetings, ${this.customization.characterName}!`,"Monsters have invaded our realm!","Defeat all enemies to unlock the door.","Collect coins and potions along the way!"],currentDialogue:0,hasQuest:!0,questCompleted:!1};this.npcs.push(s)}createCollectibles(){this.collectibles=this.physics.add.group();for(let t=0;t<5;t++){const s=n.Math.Between(100,700),e=n.Math.Between(100,500),i=this.physics.add.sprite(s,e,"items");i.setTint(16766720),i.setSize(16,16),i.setData("type","coin"),i.setData("value",10),this.collectibles.add(i)}for(let t=0;t<2;t++){const s=n.Math.Between(100,700),e=n.Math.Between(100,500),i=this.physics.add.sprite(s,e,"items");i.setTint(16729156),i.setSize(16,16),i.setData("type","potion"),i.setData("value",25),this.collectibles.add(i)}}setupCollisions(){this.physics.add.collider(this.player,this.walls),this.enemies.forEach(t=>{this.physics.add.collider(t.sprite,this.walls)}),this.enemies.forEach(t=>{this.physics.add.overlap(this.player,t.sprite,()=>{this.handlePlayerEnemyCollision(t)})}),this.npcs.forEach(t=>{this.physics.add.overlap(this.player,t.sprite,()=>{this.handlePlayerNPCInteraction(t)})}),this.physics.add.overlap(this.player,this.collectibles,(t,s)=>{this.handleCollectible(s)}),this.physics.add.overlap(this.player,this.doors,()=>{this.handleDoor()})}setupCamera(){this.cameras.main.startFollow(this.player),this.cameras.main.setBounds(0,0,800,600)}handlePlayerEnemyCollision(t){var e;const s=this.time.now;if(s-t.lastAttack>1e3){this.gameState.health-=10,t.lastAttack=s;const i=n.Math.Angle.Between(t.sprite.x,t.sprite.y,this.player.x,this.player.y);(e=this.player.body)==null||e.setVelocity(Math.cos(i)*200,Math.sin(i)*200),this.player.setTint(16711680),this.time.delayedCall(200,()=>{this.player.setTint(16777215)}),this.gameState.health<=0&&this.handlePlayerDeath(),this.updateUI()}}handlePlayerNPCInteraction(t){this.dialogueBox||this.showDialogue(t)}showDialogue(t){var h;this.currentNPC=t,this.dialogueBox=this.add.container(400,500),this.dialogueBox.setScrollFactor(0),this.dialogueBox.setDepth(1e3);const s=this.add.rectangle(0,0,600,100,0,.8),e=this.add.text(0,0,t.dialogue[t.currentDialogue],{fontSize:"14px",color:"#ffffff",fontFamily:"monospace",align:"center",wordWrap:{width:550}});e.setOrigin(.5),this.dialogueBox.add([s,e]);const i=()=>{var r;t.currentDialogue++,t.currentDialogue>=t.dialogue.length?(this.hideDialogue(),(r=this.controls.keys)==null||r.action.off("down",i)):e.setText(t.dialogue[t.currentDialogue])};(h=this.controls.keys)==null||h.action.on("down",i)}hideDialogue(){this.dialogueBox&&(this.dialogueBox.destroy(),this.dialogueBox=null,this.currentNPC=null)}handleCollectible(t){const s=t.getData("type"),e=t.getData("value");switch(s){case"coin":this.gameState.score+=e,this.addToInventory({id:"coin",name:"Gold Coin",type:"coin",quantity:1});break;case"potion":this.gameState.health=Math.min(100,this.gameState.health+e),this.addToInventory({id:"potion",name:"Health Potion",type:"potion",quantity:1});break}const i=this.add.circle(t.x,t.y,20,16777215,.8);this.tweens.add({targets:i,alpha:0,scale:2,duration:300,ease:"Power2",onComplete:()=>i.destroy()}),t.destroy(),this.updateUI()}handleDoor(){if(this.enemies.filter(s=>s.health>0).length===0)this.currentRoom++,this.currentRoom>=this.totalRooms?(this.addAchievement("completed_quest"),this.completeGame(this.gameState.score,this.gameState.achievements)):this.scene.restart();else{const s=this.add.text(400,300,"Defeat all enemies first!",{fontSize:"18px",color:"#ff0000",fontFamily:"monospace",fontStyle:"bold"});s.setOrigin(.5),this.time.delayedCall(2e3,()=>s.destroy())}}handlePlayerDeath(){this.gameState.lives--,this.gameState.lives<=0?(this.add.text(400,300,"GAME OVER",{fontSize:"32px",color:"#ff0000",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5),this.time.delayedCall(3e3,()=>{this.completeGame(this.gameState.score,this.gameState.achievements)})):(this.gameState.health=100,this.player.setPosition(100,300),this.updateUI())}update(){var o,a,p,y,g,m,u;let t=0,s=0;const e=160;(o=this.controls.keys)!=null&&o.left.isDown&&(t=-160),(a=this.controls.keys)!=null&&a.right.isDown&&(t=e),(p=this.controls.keys)!=null&&p.up.isDown&&(s=-160),(y=this.controls.keys)!=null&&y.down.isDown&&(s=e),this.controls.mobile&&(this.controls.mobile.left&&(t=-160),this.controls.mobile.right&&(t=e),this.controls.mobile.up&&(s=-160),this.controls.mobile.down&&(s=e)),(g=this.player.body)==null||g.setVelocity(t,s);const i=this.time.now,h=i-this.lastAttack>this.attackCooldown;(((m=this.controls.keys)==null?void 0:m.action.isDown)||((u=this.controls.mobile)==null?void 0:u.action))&&h&&(this.performAttack(),this.lastAttack=i),this.updateEnemies(),this.gameState.position={x:this.player.x,y:this.player.y},i%1e4<16&&this.saveGame()}performAttack(){const s=this.add.circle(this.player.x,this.player.y,60,16777215,.3);this.tweens.add({targets:s,alpha:0,scale:1.5,duration:200,ease:"Power2",onComplete:()=>s.destroy()}),this.enemies.forEach(e=>{var h;if(e.health<=0)return;if(n.Math.Distance.Between(this.player.x,this.player.y,e.sprite.x,e.sprite.y)<=60){e.health-=15;const r=n.Math.Angle.Between(this.player.x,this.player.y,e.sprite.x,e.sprite.y);(h=e.sprite.body)==null||h.setVelocity(Math.cos(r)*300,Math.sin(r)*300),e.sprite.setTint(16711680),this.time.delayedCall(200,()=>{var o;e.health<=0?(e.sprite.setTint(6710886),(o=e.sprite.body)==null||o.setVelocity(0,0),this.gameState.score+=50,this.addToInventory({id:"exp",name:"Experience",type:"powerup",quantity:1})):e.sprite.setTint(16737894)}),this.updateUI()}})}updateEnemies(){this.enemies.forEach(t=>{var s;if(!(t.health<=0)&&Math.random()<.005){const e=n.Math.Angle.Between(t.sprite.x,t.sprite.y,this.player.x,this.player.y);(s=t.sprite.body)==null||s.setVelocity(Math.cos(e)*30,Math.sin(e)*30)}})}}export{C as PixelQuestScene};
